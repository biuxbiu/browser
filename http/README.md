# 了解Http

前面我们大概的说了一下 `Http` 是什么。`Http` 和 `TCP` 的关系。<br>
下面我们来认真了解一下 `Http` 的请求流程。

#### http和TCP的联系

>`http` 属于应用层。`TCP` 属于传输层。`Http` 是建立在 `TCP` 之上。<br>每一个 `HTTP` 的请求都会返回一个 `content-type` ，然后交给渲染进程处理；<br>
`TCP` 负责把东西传输给到 `HTTP` 。
`TCP` 属于负责传送，而 `HTTP` 可以具体到某一件东西，比如我们平常见的 `css` / `image/jpeg` / `text/javascript` 等等

<Br>
<Br>


!>`http` 有以下3个问题：<br>
内容未加密，容易被监听，都是明文传输；<Br>
无法验证内容的完整性，不知道内容有没有被修改过或者容易被篡改；<br>
无法验证对方的身份，无法知道目前对话的人是谁；

#### http的请求流程

* 构建请求
* 查找缓存
* 准备IP地址和端口
* 等待TCP队列
* 建立TCP连接
* 发送HTTP请求

<Br>
<Br>

###### 构建请求

浏览器内部构建请求信息，准备发起网络请求；

```copy
GET /ndex.html HTTP1.1
```

<br>
<br>

###### 查找缓存

在真正发起请求的时候，浏览器会先从本地查找是否有缓存。如果有缓存就会拦截请求，直接读取本地资源。

>读取本地缓存有几个比较好的优势，读取本地缓存可以缓解服务器的压力，可以快速读取资源打开页面。

!>如果本地读取缓存失败了，就会真正的发起请求。

<Br>
<Br>

###### 准备IP地址和端口

说到这里，我们要回顾一下之前我们了解的 `TCP/IP` 协议；<br>
我们知道 `TCP` 的生命周期有三个阶段：`建立链接（三次握手）` 、 `传输数据` 、 `断开连接（四次挥手）`;<br>
服务器在 `传输数据` 阶段会处理 `Http` 的请求，也就是说 `Http` 的内容都是通过 `TCP` 数据传输阶段来实现的。

<img src="../img/TCP-life.jpg">

从上面的图片可以看出，要处理 `Http` 请求的第一步就是和服务器建立 `TCP` 连接；<Br>
要建立 `TCP` 连接，我们必须要知道 `IP地址` 和 `端口号`；<br>
如何获取端口号，我们能不能通过一个 `URL` 地址就知道 `IP地址` 和 `端口号`。<Br>

<b>怎么获取 `URL` 的 `IP地址` 和 `端口号`?</b><br>
要获取 `URL` 的 `IP地址`，这个时候我们就要了解一下什么是 `DNS`。

```copy
什么是DNS

`DNS` 域名系统（Domain Name System 或 Domain Name Service）
日常中我们访问的每个域名，其实都对应一个 `IP` 地址。这个地址是一串数字，比较难记，所以才有了域名的出现，域名和 `IP` 存在映射关系。
`DNS` 指的是域名和 `IP` 地址相互映射的一个分布式数据库；

`DNS` 解析过程：

* 检查浏览器缓存中是否有该域名对应的IP地址:
>当浏览器浏览过某个网站，浏览器缓存中就会自动缓存这个网站域名对应的地址。用户再次打开这个域名的时候，浏览器就会再次从缓存中找到这个
IP地址。当从缓存中找到这个IP地址，`DNS解析过程` 结束。

* 浏览器中没有找到该IP地址，就会从电脑中查找是否缓存过这个IP地址:
>当从浏览器中没有找到该IP地址，就会从电脑的 `hosts` 文件位置查看是否有将该域名和IP地址做一个绑定；

* 如果浏览器和电脑中都没找到:
>那么系统就会请求本地域名解析服务系统解析；
如果你在校内网，那么你的本地域名解析服务系统就在学校的机房，如果你链接的是电信，那么你的本地域名解析服务系统就由本地区的运营服务商来提供。
```

从上面的流程不断推敲，我们知道要处理 `Http` 请求，我们必须先建立 `TCP` 连接。要建立 `TCP` 连接，必须得先知道 `IP地址` 和 `端口号`。
 `IP地址` 和 `端口号` 我们如何获取呢？

因为 `DNS` ，所以我们可以通过域名映射获得 `IP地址` 。<Br>
一般情况下，`URL` 没有指明端口号的话，默认端口号为 `80` 端口。

<Br>
<Br>

###### 等待TCP队列

已经有了 `IP地址` 和 `端口号`，我们是不是就可以开始 `TCP` 连接了呢？<Br>
不是的，Chrome 机制限制了同时只可以建立 `6个` `TCP` 链接。 如果在同一个域名下面同时有10个请求发生的话，有4个就会被挂起等待。直至进行中的请求完成为止。


<Br>
<Br>

###### 建立TCP连接

望穿秋水，到了这一步，终于可以建立 `TCP` 连接了。<Br>
`TCP` 的连接建立需要经过三次握手才能成功。（可以回顾上一个章节的内容）；

<Br>
<Br>

###### 发送HTTP请求

`TCP` 建立连接成功之后就可以传送数据了。

<br>
<br>

#### HTTP请求过程

<b>浏览器是如何发送请求给服务器的？</b>

我们可以在 `linux` 通过命令 `curl` 可以查看返回的响应行响应头和响应提的数据，开进一步理解服务器是怎么响应浏览器的。

以网站 `http://www.biuxbiu.design/#/` 为例子，

我们在终端输入以下命令：

```copy
curl -i http://www.biuxbiu.design/#/
```

返回的命令如下：

```copy

```

<Br>
<Br>

#### http和https的区别

>`http` ：是超文本传输协议，信息是明文传输的；<br>
`https` ：在 `http` 上多了一层 `SSL` 的加密传输协议；<br><br>
首先 `https` 是 `http Security` 的简称；<Br>
虽说是 `https` 但是，本质上还是 `http` ；为什么呢？只不过因为 `https` 在传输层多了一步，这一步就是 `加密` ； 

>`http` ：是超文本传输协议，信息是文明传输的；<br>
`https` ：是具有安全性的 `SSL` 加密传输协议；<br><br>

两者是完全不同的连接方式，用的端口也不一样；<br>
`http` 用的是 `80` 端口；<br>
`https` 用的是 `443` 端口；<br><br>
`http` 的链接很简单，是无状态的；<br>
`https` 的链接是由 `SSL+HTTP` 协议构建的，可进行加密传输，身份认证的网络协议要比 `http` 协议安全；

<Br>

!>`明文传输` 指的数据是在计算机中传输并没有经过加密处理。<Br>
`SSL` 指的是 `Secure Socket Layer 安全套接层`；`https` 在提交给传输层（`tcp`）前发生。涉及到 `对称密钥`，`非对称密钥`。
`对称密钥` 就是一对密钥，`非对称密钥` 就有两对密钥，双方各自持有对方的公钥，自己拿着私钥。<br>
`TLS` 指的是 `传输层安全` 是更为安全的升级版 SSL；


<Br>
<Br>

#### 多标签页的浏览器端口

<b>现代浏览器可以同时打开很多标签，端口都是一样的吗？数据怎么知道去到哪个标签页？</b><br>

>端口号都是一样的，当浏览器拿到数据之后，网络进程会将 `TCP链接` 交给对应的标签页， 然后会把数据分发给对应的渲染进程；


<br>
<br>

#### TCP数据包丢失和HTTP的渲染关系

<b>`TCP` 传送数据的时候，就已经开始渲染页面了吗？如果数据包丢失，实时渲染的页面怎么呈现？</b><br>

>当 `TCP` 交给应用层，应用层解析 `HTTP` 响应头的 `contnet-type` 类型的时候就开始准备渲染页面了。<br>
数据包是否丢失，是否完整的情况其实不影响实时渲染，因为数据包的完整性是在 `TCP` 阶段就已经通过检验的（ `TCP` 阶段对丢失的数据包有重传机制）； 


#### 总结

<br>
<br>

#### http状态码

|http状态码|详细状态码|状态原因|
|--|--|--|
|1xx||消息|
|2xx||成功|
|3xx||重定向|
|4xx||客户端错误|
|5xx||服务端错误|
|5xx|500|借口报错|
|5xx|502|后端服务没开启|
|5xx|503|启动挂了|


<!-- https://juejin.im/post/5df7959051882512480a83e7?utm_source=gold_browser_extension

https://juejin.im/post/5df8f11df265da33f40f255e?utm_source=gold_browser_extension -->